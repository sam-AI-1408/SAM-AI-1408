<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üí° Finance Education Game</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg,#050615,#0f1630);
      color: #eaf6ff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
      min-height: 100vh;
      margin: 0;
    }
    h1,h2,h3 { margin: 10px 0; text-align: center; }
    p { margin: 5px 0; text-align: center; }

    .game-container { max-width: 800px; width: 100%; display: flex; flex-direction: column; align-items: center; gap: 20px; }

    .budget-box {
      background: #0f1630;
      padding: 15px 25px;
      border-radius: 15px;
      border: 2px solid #00d0ff;
      font-size: 18px;
      box-shadow: 0 0 20px rgba(0,208,255,0.3);
      width: 100%;
      text-align: center;
    }

    .instructions {
      background: #111b3a;
      padding: 15px 20px;
      border-radius: 12px;
      border-left: 4px solid #00d0ff;
      font-size: 14px;
      text-align: center;
      max-width: 700px;
    }

    .categories { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
    .category {
      background: #111b3a;
      padding: 15px;
      border-radius: 15px;
      text-align: center;
      width: 160px;
      cursor: pointer;
      border: 2px solid #00d0ff;
      transition: transform 0.2s ease, background 0.2s ease, border-color 0.2s ease;
    }
    .category:hover { transform: translateY(-5px) scale(1.05); background: #152452; border-color: #ffd24d; }
    .category.funded { background: #0a2b1f; border-color: #4dff7e; cursor: default; }
    .category .amount { font-weight: bold; color: #00d0ff; margin-top: 5px; }

    .allocations {
      margin-top: 10px;
      padding: 15px;
      border: 2px dashed #00d0ff;
      border-radius: 12px;
      max-width: 500px;
      text-align: center;
    }

    .score { margin-top: 10px; font-size: 18px; font-weight: bold; }

    button {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      background: #00d0ff;
      color: #050615;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s ease, filter 0.2s ease;
    }
    button:hover { transform: scale(1.05); filter: brightness(1.1); }
    .finish-btn { background: #ffd24d; color: #001; }
    .back-btn { background: #4dff7e; color: #001; }
    
    .report {
      background: #111b3a;
      border-radius: 15px;
      padding: 20px;
      border: 2px solid #00d0ff;
      margin-top: 20px;
      max-width: 600px;
      display: none;
    }
    .report h3 { color: #ffd24d; }
  </style>
</head>
<body>

  <h1>üí° Finance Education Game</h1>
  <p>Learn how to manage money by allocating wisely between needs, wants, and savings.</p>

  <div class="instructions">
    <h3>How to Play:</h3>
    <p>1Ô∏è‚É£ You start with a random budget.</p>
    <p>2Ô∏è‚É£ Click a category to allocate 5 coins at a time.</p>
    <p>3Ô∏è‚É£ Necessities (Food, Rent, Health, Education) MUST be funded first.</p>
    <p>4Ô∏è‚É£ Luxuries (Shopping, Entertainment) are optional.</p>
    <p>5Ô∏è‚É£ You can also leave money unspent ‚Üí savings = bonus points!</p>
    <p>üéØ Goal: Balance Needs ‚úÖ + Some Wants üôÇ + Savings üí∞</p>
  </div>

  <div class="game-container">
    <div class="budget-box">
      Total Budget: <span id="budget">0</span> coins
    </div>

    <div class="categories" id="categories"></div>

    <div class="score" id="message">üí° Allocate your money wisely!</div>

    <div class="allocations">
      <h3>üìä Your Allocations</h3>
      <ul id="allocationList"></ul>
    </div>

    <button onclick="finishGame()" class="finish-btn">‚úÖ Complete Shopping</button>
    <button onclick="resetGame()" class="win-loss-btn">üîÑ New Round</button>
    <a href="{{ url_for('quests_page') }}"><button class="back-btn">‚¨Ö Back to Quests</button></a>

    <div class="report" id="report"></div>
  </div>

  <script>
    let budget = 0;
    let allocations = [];

    const categoryPool = [
      { name: "Food", type: "necessity" },
      { name: "Rent", type: "necessity" },
      { name: "Education", type: "necessity" },
      { name: "Health", type: "necessity" },
      { name: "Transport", type: "necessity" },
      { name: "Entertainment", type: "luxury" },
      { name: "Shopping", type: "luxury" },
      { name: "Savings", type: "savings" }
    ];

    const categoriesEl = document.getElementById("categories");

    function randomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    function generateCategories() {
      categoriesEl.innerHTML = "";
      allocations = [];
      categoryPool.forEach(cat => {
        const target = (cat.type === "necessity") ? randomInt(20, 50) : randomInt(10, 40);
        allocations.push({ category: cat.name, type: cat.type, amountAllocated: 0, target });

        const div = document.createElement("div");
        div.className = "category";
        div.innerHTML = `<p>${cat.name}</p><p class="amount">0 / ${target}</p>`;
        div.onclick = () => allocate(cat.name);
        categoriesEl.appendChild(div);
      });
    }

    function allocate(catName) {
      const cat = allocations.find(c => c.category === catName);
      const div = [...categoriesEl.children].find(d => d.firstChild.textContent === cat.category);

      if (budget <= 0) {
        document.getElementById("message").textContent = "‚ùå No more coins left!";
        return;
      }
      if (cat.amountAllocated >= cat.target && cat.type !== "savings") {
        document.getElementById("message").textContent = `‚úÖ ${catName} is fully funded!`;
        return;
      }

      const allocateAmount = Math.min(5, budget, cat.target - cat.amountAllocated || 5);
      cat.amountAllocated += allocateAmount;
      budget -= allocateAmount;

      div.querySelector(".amount").textContent = `${cat.amountAllocated} / ${cat.target}`;
      if (cat.amountAllocated >= cat.target && cat.type !== "savings") div.classList.add("funded");

      updateAllocations();
    }

    function updateAllocations() {
      document.getElementById("budget").textContent = budget;
      const list = document.getElementById("allocationList");
      list.innerHTML = "";
      allocations.forEach(cat => {
        const li = document.createElement("li");
        li.textContent = `${cat.category}: ${cat.amountAllocated} / ${cat.target}`;
        list.appendChild(li);
      });
    }

    function finishGame() {
      let necessitiesFunded = allocations.filter(c => c.type === "necessity").every(c => c.amountAllocated >= c.target);
      let savings = allocations.find(c => c.type === "savings").amountAllocated;
      let luxuries = allocations.filter(c => c.type === "luxury").reduce((sum, c) => sum + c.amountAllocated, 0);

      let score = 0;
      if (necessitiesFunded) score += 50;
      score += Math.min(savings, 50); // reward savings
      score += Math.min(luxuries, 20); // small reward for enjoying life

      let report = `
        <h3>üìë Financial Report</h3>
        <p>Necessities funded: ${necessitiesFunded ? "‚úÖ Yes" : "‚ùå No"}</p>
        <p>Total Savings: üí∞ ${savings} coins</p>
        <p>Luxury Spending: üéÆ ${luxuries} coins</p>
        <p><b>Final Score: ${score} / 120</b></p>
        <h4>üí° Tip:</h4>
        <p>${necessitiesFunded ? "Great job prioritizing needs!" : "Always cover your needs first before wants."}</p>
        <p>${savings > 0 ? "Good work saving money!" : "Try to save at least some money for future."}</p>
      `;
      const reportEl = document.getElementById("report");
      reportEl.innerHTML = report;
      reportEl.style.display = "block";
    }

    function resetGame() {
      budget = randomInt(100, 200);
      document.getElementById("message").textContent = "üí° Allocate your money wisely!";
      document.getElementById("budget").textContent = budget;
      document.getElementById("report").style.display = "none";
      generateCategories();
      updateAllocations();
    }

    resetGame();
  </script>
</body>
</html>
